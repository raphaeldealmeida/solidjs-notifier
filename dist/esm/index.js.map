{"version":3,"file":"index.js","sources":["../../src/notifier.tsx"],"sourcesContent":["import { createSignal, For, JSX, Show } from \"solid-js\"\nimport { Transition } from \"solid-transition-group\"\n//import { CloseButton } from \"../widgets/close-button\"\nimport \"virtual:windi.css\"\n\nexport const ICONS = {\n\tbell: `<svg width=\"16\" height=\"16\" viewBox=\"0 0 16 16\"\n\t\tfill=\"currentColor\" xmlns=\"http://www.w3.org/2000/svg\">\n\t\t<path d=\"M8 16a2 2 0 002-2H6a2 2 0 002 2zm.995-14.901a1 1 0 10-1.99 0A5.002 5.002 0 003 6c0 1.098-.5 6-2 7h14c-1.5-1-2-5.902-2-7 0-2.42-1.72-4.44-4.005-4.901z\"/>\n\t\t</svg>`\n}\nexport enum NotificationLevel {\n\tdanger = \"danger\",\n\twarning = \"warning\",\n\tinfo = \"info\",\n\tsuccess = \"success\",\n}\n\nexport type TNotification = {\n\tid?: number\n\tlevel: NotificationLevel\n\ttitle?: string \n\tplain?: string \n\thtml?: string \n\tcreated?: Date\n\tisToast?: boolean \n\tseen?: boolean \n}\n\nexport abstract class AbstractNotification {\n\tid?: number\n\tlevel: NotificationLevel\n\ttitle?: string = \"\"\n\tabstract get someTitle(): string \n\tplain?: string = \"\"\n\thtml?: string = \"\"\n\tabstract get css(): string \n\tcreated?: Date\n\tisToast?: boolean = true\n\tseen?: boolean = false\n}\nexport type TNotifProps = {\n\tstore: { notifications: Array<TNotification> }\n\tsetNotifications: (arr: Array<TNotification>) => void\n}\n\nexport class Notification implements TNotification {\n\tid?: number\n\tlevel: NotificationLevel\n\ttitle?: string = \"\"\n\tplain?: string = \"\"\n\thtml?: string = \"\"\n\tcreated?: Date\n\tisToast?: boolean = true\n\tseen?: boolean = false\n\tstatic nextId: number = 0\n\tstatic speed = 90; // Takes one second to read 11 chars\n\tstatic min = 3000; // but the minimum is 3 seconds\n\n\tconstructor(arg: TNotification) {\n\t\tObject.assign(this, arg)\n\t\tif (!this.created) this.created = new Date()\n\t\tthis.id = ++Notification.nextId\n\t}\n\tstatic new(arg: TNotification): TNotification {\n\t\treturn new this(arg)\n\t}\n\tget someTitle() {\n\t\treturn this.title || (this.level).charAt(0).toUpperCase() + (this.level).slice(1)\n\t}\n\tget css() {\n\t\tswitch (this.level) {\n\t\t\tcase \"danger\":\n\t\t\t\treturn \"bg-danger border-danger\"\n\t\t\tcase \"warning\":\n\t\t\t\treturn \"bg-warning border-warning\"\n\t\t\tcase \"info\":\n\t\t\t\treturn \"bg-info border-info\"\n\t\t\tcase \"success\":\n\t\t\t\treturn \"bg-success border-success\"\n\t\t\tdefault:\n\t\t\t\tthrow new Error(`Unexpected notification level: \"${this.level}\"`)\n\t\t}\n\t}\n\tget readingTime() {\n\t\t// Estimate the time one takes to read some text\n\t\tlet len = 0\n\t\tif (this.title) len += this.title.length\n\t\tif (this.html) len += this.html.length\n\t\tif (this.plain) len += this.plain.length\n\t\tconst duration = len * Notification.speed\n\t\tif (duration < Notification.min) return Notification.min\n\t\telse return duration\n\t}\n}\n\nconst [queueToast, setQueueToast] = createSignal([])\nconst [activeModal, setActiveModal] = createSignal(null)\nconst [activeToast, setActiveToast] = createSignal(null)\n\n\n/** A notification area. */\nexport class Notifier {\n\tprivate store: TNotifProps[\"store\"]\n\tprivate setNotifications: TNotifProps[\"setNotifications\"]\n\treadonly isOpen: () => boolean\n\tprivate setIsOpen\n\treadonly unreadFilter: () => boolean\n\tprivate setUnreadFilter\n\tprivate timer: NodeJS.Timeout = null\n\n\tconstructor(props: TNotifProps) {\n\t\tthis.store = props.store\n\t\tthis.setNotifications = props.setNotifications;\n\t\t[this.isOpen, this.setIsOpen] = createSignal(false);\n\t\t[this.unreadFilter, this.setUnreadFilter] = createSignal(false)\n\n\t\tthis.pleaseBind(this, [ // prevent problems with event handlers\n\t\t\t\"onDocClick\", \"hide\", \"onKeyDown\", \"onCheckbox\", \"onMarkSeen\",\n\t\t\t\"oneNotificationView\", \"activeToastView\", \"nextQueuedToast\",\n\t\t\t\"view\", \"dismissToast\", \"toggleUnreadFilter\",\n\t\t])\n\t}\n\tpublic static new(props: TNotifProps): Notifier {\n\t\treturn Object.seal(new this(props))\n\t}\n\tprivate pleaseBind(component: object, names: string[]) {\n\t\t// *names* is passed in but we keep only the methods.\n\t\tconst methods = names.filter(name => typeof component[name] === \"function\")\n\t\tfor (const method of methods) {\n\t\t\tcomponent[method] = component[method].bind(component)\n\t\t}\n\t}\n\tpublic addNotification(notification: TNotification) {\n\n\t\tconst list = Array.from(this.store.notifications) as TNotification[]\n\n\t\tif (notification.isToast) {\n\t\t\tnotification.seen = true\n\t\t\tsetActiveModal(notification)\n\t\t} else {\n\t\t\tsetQueueToast([...queueToast(), notification])\n\t\t\tif (!activeToast()) this.nextQueuedToast()\n\t\t}\n\n\t\tlist.unshift(notification)\n\t\tthis.setNotifications(list)\n\n\t}\n\tprivate setNotificationSeen(\n\t\tnotifications: TNotification[],\n\t\tid: number,\n\t\tseen: boolean,\n\t): TNotification[] {\n\t\tconst old = notifications.find(n => n.id === id)\n\t\tconst ntf = Notification.new(old)\n\t\tntf.seen = seen\n\t\treturn Array.from(\n\t\t\tnotifications, (x) => x === old ? ntf : x\n\t\t) as AbstractNotification[]\n\t}\n\tprivate nextQueuedToast() {\n\t\tlet queue = queueToast()\n\t\tlet toast = queue.shift()\n\t\tsetActiveToast(toast)\n\n\t\tif (!activeToast()) return false\n\n\t\tthis.timer = setTimeout(this.nextQueuedToast, toast.readingTime)\n\t\tsetQueueToast(queue)\n\t}\n\tpublic toggle(): void {\n\t\tif (this.isOpen())\n\t\t\tthis.hide()\n\t\telse\n\t\t\tthis.show()\n\t}\n\ttoggleUnreadFilter() {\n\t\tthis.setUnreadFilter(!this.unreadFilter())\n\t}\n\tshow() {\n\t\tsetQueueToast([])\n\t\tthis.dismissToast()\n\t\tthis.setIsOpen(true)\n\t\tdocument.addEventListener(\"click\", this.onDocClick)\n\t\tdocument.addEventListener(\"keydown\", this.onKeyDown)\n\t}\n\t/** Hide the Notifier as long as the click was outside it. */\n\tprivate onDocClick(ev: MouseEvent) {\n\t\tconst notifierDiv = document.querySelector(\"#notifier\")\n\t\tif (notifierDiv === ev.target\n\t\t\t|| notifierDiv.contains(ev.target as Node)) {\n\t\t\treturn // since clicked inside the div\n\t\t} else {\n\t\t\tthis.hide()\n\t\t}\n\t}\n\tprivate hide() {\n\t\tthis.setIsOpen(false)\n\t\tdocument.removeEventListener(\"click\", this.onDocClick)\n\t\tdocument.removeEventListener(\"keydown\", this.onKeyDown)\n\t}\n\tprivate onKeyDown(ev: KeyboardEvent) {\n\t\tif (ev.key == \"Escape\") this.hide()\n\t}\n\tprivate onCheckbox(ev: Event) {\n\t\tconst checkbox = ev.target as HTMLInputElement\n\t\tconst id = parseInt(checkbox.dataset.id)\n\t\tthis.setNotifications(this.setNotificationSeen(\n\t\t\tthis.store.notifications, id, checkbox.checked,\n\t\t))\n\t}\n\tprivate onMarkSeen(ev: Event) {\n\t\tconst checkbox = ev.target as HTMLInputElement\n\t\tconst id = parseInt(checkbox.dataset.id)\n\t\tthis.setNotifications(this.setNotificationSeen(\n\t\t\tthis.store.notifications, id, true,\n\t\t))\n\t\tthis.dismissToast()\n\t}\n\tprivate dismissToast() {\n\t\tsetActiveToast(null)\n\t\tclearTimeout(this.timer)\n\t\tthis.nextQueuedToast()\n\t}\n\t/** Return the number of notifications to be read. */\n\tpublic get notSeen() {\n\t\tlet notSeen = 0\n\t\tfor (const notif of this.store.notifications) {\n\t\t\tif (!notif.seen) ++notSeen\n\t\t}\n\t\treturn notSeen\n\t}\n\tpublic notSeenView(): Element {\n\t\tconst notSeen = this.notSeen\n\t\tconst bg = notSeen ? \"bg-unread\" : \"bg-gray\"\n\t\treturn <small\n\t\t\ttitle={notSeen.toString() + \" not seen\"}\n\t\t\tclass={\"px-1 rounded-full text-light-200 \" + bg}\n\t\t>{notSeen}</small> as Element\n\t}\n\tprivate oneNotificationView(entry: AbstractNotification): JSX.Element {\n\t\tconst self = this\n\t\treturn <Show when={this.unreadFilter() ? !entry.seen : true}>\n\t\t\t<div class={\n\t\t\t\t\"p-2 my-2 rounded border border-popover \" +\n\t\t\t\t(entry.seen ? \"bg-opacity-30 \" : \"\") + entry.css\n\t\t\t}>\n\t\t\t\t<label class=\"text-lg\" title={entry.seen ? \"seen\" : \"not seen\"}>\n\t\t\t\t\t<input type=\"checkbox\" data-id={entry.id}\n\t\t\t\t\t\tchecked={entry.seen}\n\t\t\t\t\t\tonChange={self.onCheckbox}\n\t\t\t\t\t/>&nbsp;\n\t\t\t\t\t<span class=\"border-b\">{entry.someTitle}</span>\n\t\t\t\t</label>\n\t\t\t\t<div class=\"p-1\" innerHTML={entry.html || entry.plain}></div>\n\t\t\t\t<p class=\"text-xs\">{entry.created.toLocaleString()}</p>\n\t\t\t</div>\n\t\t</Show>\n\t}\n\tprivate activeToastView(entry: AbstractNotification): JSX.Element {\n\t\tconst self = this\n\t\treturn (\n\t\t\t<div class=\"top-5 right-0 fixed z-50 w-full md:max-w-sm p-4 md:p-4 max-h-screen overflow-hidden pointer-events-none\">\n\t\t\t\t<div class=\"flex-1 flex-col fade w-full mr-8 justify-end pointer-events-none\">\n\t\t\t\t\t<div class=\"flex py-1 w-full transform transition-all duration-300 pointer-events-auto\">\n\t\t\t\t\t\t<div class={\"flex w-full visible flex-row shadow-lg border-l-4 rounded-md duration-100 cursor-pointer transform transition-all hover:scale-102 bg-\" + entry.level}>\n\t\t\t\t\t\t\t<div class=\"flex flex-row p-2 flex-no-wrap w-full\">\n\t\t\t\t\t\t\t\t<div class=\"flex flex-col flex-no-wrap px-1 w-full\">\n\t\t\t\t\t\t\t\t\t<div class=\"flex my-auto font-bold select-none\" data-id={entry.id} onClick={self.onMarkSeen}>\n\t\t\t\t\t\t\t\t\t\t{entry.someTitle}\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<p class=\"mt-1 my-auto flex text-gray-700 text-sm truncate-1-lines\"\n\t\t\t\t\t\t\t\t\t\tinnerHTML={entry.html || entry.plain} data-id={entry.id} onClick={self.onMarkSeen} />\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div class=\"w-5 h-5 mr-2 items-center mx-auto text-center leading-none\">\n\t\t\t\t\t\t\t\t\t<button class=\"text-xs underline text-gray-800\"\n\t\t\t\t\t\t\t\t\t\tdata-id={entry.id} onClick={self.dismissToast}>\n\t\t\t\t\t\t\t\t\t\tLater\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t&nbsp&nbsp\n\t\t\t\t\t\t\t\t<div class=\"w-5 h-5 mr-2 items-center mx-auto text-center leading-none\">\n\t\t\t\t\t\t\t\t\t<button class=\"text-xs underline text-gray-800\"\n\t\t\t\t\t\t\t\t\t\tdata-id={entry.id} onClick={self.onMarkSeen}>\n\t\t\t\t\t\t\t\t\t\tSeen\n\t\t\t\t\t\t\t\t\t</button>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n\tprivate activeModalView(entry: AbstractNotification): JSX.Element {\n\t\tconst self = this\n\t\treturn (\n\t\t\t<div class=\"fixed flex items-center justify-center overflow-auto z-50 bg-gray bg-opacity-40 left-0 right-0 top-0 bottom-0\">\n\t\t\t\t<div class=\"bg-normal rounded-xl shadow-2xl p-6 sm:w-10/12 mx-10\">\n\t\t\t\t\t<span class=\"font-bold block text-2xl mb-3\">{entry.someTitle}</span>\n\t\t\t\t\t<div class=\"p-1\" innerHTML={entry.html || entry.plain}></div>\n\n\t\t\t\t\t<div class=\"text-right space-x-5 mt-5\">\n\t\t\t\t\t\t<button onClick={() => { setActiveModal(null) }} class=\"px-4 py-2 text-sm bg-white rounded-xl border transition-colors duration-150 ease-linear border-gray-200 focus:outline-none focus:ring-0 font-bold hover:bg-gray-50 focus:bg-indigo-50 focus:text-indigo\">Okay</button>\n\t\t\t\t\t</div>\n\t\t\t\t</div>\n\t\t\t</div>\n\t\t)\n\t}\n\tview(): JSX.Element {\n\t\treturn <>\n\t\t\t<Show when={activeModal()}>\n\t\t\t\t{this.activeModalView(activeModal())}\n\t\t\t</Show>\n\t\t\t<Transition\n\t\t\t\tonBeforeEnter={(el: HTMLElement) => (el.style.opacity = \"0\")}\n\t\t\t\tonEnter={(el, done) => {\n\t\t\t\t\tconst a = el.animate([{ opacity: 0, top: '5rem' }, { opacity: 1, top: '1.25rem' }], {\n\t\t\t\t\t\tduration: 500\n\t\t\t\t\t})\n\t\t\t\t\ta.finished.then(done)\n\t\t\t\t}}\n\t\t\t\tonAfterEnter={(el: HTMLElement) => (el.style.opacity = \"1\")}\n\t\t\t\tonExit={(el, done) => {\n\t\t\t\t\tconst a = el.animate([{ opacity: 1, top: '1.25rem' }, { opacity: 0, top: 0 }], {\n\t\t\t\t\t\tduration: 300\n\t\t\t\t\t})\n\t\t\t\t\ta.finished.then(done)\n\t\t\t\t}}\n\t\t\t>\n\t\t\t\t<Show when={activeToast()} >\n\t\t\t\t\t{this.activeToastView(activeToast())}\n\t\t\t\t</Show>\n\t\t\t</Transition>\n\t\t\t<Show when={this.isOpen()}>\n\t\t\t\t<div id=\"notifier\" class=\"fixed right-0 min-w-1/3 max-w-sm p-3 rounded border border-popover bg-popover overflow-y-auto h-4/5 z-50 shadow-xl\">\n\t\t\t\t\t{/* <CloseButton onClick={this.hide} /> */}\n\t\t\t\t\t<h1 class=\"text-xl\">\n\t\t\t\t\t\t<span class=\"inline-block\" innerHTML={ICONS.bell} />\n\t\t\t\t\t\t&nbsp; Notifications\n\t\t\t\t\t\t<small class=\"ml-2\">{this.notSeenView()}</small>\n\t\t\t\t\t</h1>\n\t\t\t\t\t<hr />\n\t\t\t\t\t<p>\n\t\t\t\t\t\t<button onClick={this.toggleUnreadFilter}\n\t\t\t\t\t\t\tclass=\"text-xs underline text-gray-800 focus:outline-none\"\n\t\t\t\t\t\t\ttitle={this.unreadFilter() ? \"Currently showing subset\" : \"Currently showing all notifications\"}\n\t\t\t\t\t\t>{this.unreadFilter() ? 'View all' : 'Filter by unread'}\n\t\t\t\t\t\t</button>\n\t\t\t\t\t</p>\n\t\t\t\t\t<For each={this.store.notifications}>{\n\t\t\t\t\t\tthis.oneNotificationView\n\t\t\t\t\t}</For>\n\t\t\t\t</div>\n\t\t\t</Show>\n\t\t</>\n\t}\n}\n"],"names":["ICONS","bell","NotificationLevel","AbstractNotification","Notification","constructor","arg","Object","assign","created","Date","id","nextId","new","someTitle","title","level","charAt","toUpperCase","slice","css","Error","readingTime","len","length","html","plain","duration","speed","min","queueToast","setQueueToast","createSignal","activeModal","setActiveModal","activeToast","setActiveToast","Notifier","props","store","setNotifications","isOpen","setIsOpen","unreadFilter","setUnreadFilter","pleaseBind","seal","component","names","methods","filter","name","method","bind","addNotification","notification","list","Array","from","notifications","isToast","seen","nextQueuedToast","unshift","setNotificationSeen","old","find","n","ntf","x","queue","toast","shift","timer","setTimeout","toggle","hide","show","toggleUnreadFilter","dismissToast","document","addEventListener","onDocClick","onKeyDown","ev","notifierDiv","querySelector","target","contains","removeEventListener","key","onCheckbox","checkbox","parseInt","dataset","checked","onMarkSeen","clearTimeout","notSeen","notif","notSeenView","bg","toString","oneNotificationView","entry","self","toLocaleString","activeToastView","activeModalView","view","el","style","opacity","done","a","animate","top","finished","then"],"mappings":"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"}